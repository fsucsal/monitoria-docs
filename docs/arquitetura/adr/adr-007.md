# ADR-007 — Geração de certificados: processamento assíncrono com extração futura para microsserviço

**Status:** Aprovado

## Contexto

A geração de certificados envolve operações potencialmente custosas e não determinísticas em tempo de execução, tais como:

- Geração de arquivos PDF
- Escrita em disco ou em storage externo
- Envio de notificações (e-mail ou outros meios)
- Registro de metadados para auditoria e rastreabilidade

Além disso, o domínio de certificados possui uma característica estratégica: **no médio prazo, deverá atender também outro sistema institucional (Sistema de Eventos)**. Isso implica na necessidade de **baixo acoplamento** e **preparação para reutilização**.

No estágio atual, a aplicação adota uma arquitetura de **Monólito Modular**, com foco em simplicidade, previsibilidade e aprendizado do time.

## Decisão

A geração de certificados será tratada como um **processo assíncrono**, desacoplado da requisição HTTP, respeitando as seguintes diretrizes:

- A solicitação de geração será feita via API REST
- A API retornará imediatamente, sem bloquear o processamento
- A geração ocorrerá em segundo plano, por meio de:

  - Fila de processamento
  - Worker dedicado

- O estado do processamento (pendente, concluído, erro) deverá ser persistido

Do ponto de vista arquitetural:

- O módulo de certificados será implementado **dentro do monólito**, porém:

  - Com isolamento claro de responsabilidades
  - Com interfaces bem definidas
  - Sem dependências diretas de outros módulos

- O desenho do módulo deverá permitir **extração futura para um microsserviço**, sem refatorações profundas

> Importante: **a implementação assíncrona não é obrigatória no MVP**, mas a estrutura do código deverá respeitar essa diretriz desde o início.

## Alternativas Consideradas

- Geração síncrona via API REST
- Processamento por batch manual (jobs agendados)

Essas alternativas foram descartadas por:

- Risco de timeout em requisições HTTP
- Experiência ruim para o usuário
- Dificuldade de escalar o processamento
- Maior acoplamento com o fluxo síncrono da aplicação

## Consequências

### Consequências Positivas

- Evita bloqueio e timeout de requisições HTTP
- Melhora a experiência do usuário
- Permite escalabilidade independente do processamento
- Prepara o módulo para reutilização em outros sistemas
- Facilita a futura extração como microsserviço

### Consequências Negativas

- Introduz a necessidade de fila e worker
- Exige controle explícito do estado do processamento
- Aumenta levemente a complexidade arquitetural

## Diretrizes Evolutivas

- No MVP:

  - A geração poderá ser simulada ou simplificada
  - O fluxo deve manter a separação entre requisição e processamento

- Na evolução do sistema:

  - A fila poderá ser substituída por tecnologia dedicada (ex: mensageria)
  - O módulo poderá ser extraído como serviço independente

Essa decisão garante que o sistema permaneça simples no curto prazo, sem bloquear uma evolução arquitetural necessária no médio prazo.
