# ADR-008 — Armazenamento de Arquivos: Object Storage com Preparação para Extração Futura

**Status:** Aprovado

---

## Contexto

O sistema realiza a **geração de certificados em PDF**, que possuem as seguintes características:

- Precisam ser armazenados de forma **durável e segura**
- Devem estar disponíveis para **download posterior**
- Poderão ser reutilizados futuramente por **outro sistema institucional (Sistema de Eventos)**

Além disso:

- A geração de certificados já possui **diretriz arquitetural para execução assíncrona**
- O módulo de certificados tem **planejamento de extração futura como microsserviço**
- O projeto segue uma arquitetura de **Monólito Modular**, com preocupação em:

  - Isolamento de responsabilidades
  - Evolução arquitetural sem retrabalho

Diante disso, o modelo de armazenamento de arquivos **não deve acoplar** os certificados ao backend principal nem ao banco de dados relacional.

---

## Decisão

Adotar **Object Storage compatível com S3** como padrão oficial de armazenamento de arquivos do sistema, especificamente para certificados em PDF.

As diretrizes são:

- O armazenamento de certificados **não será feito em disco local da aplicação**
- O acesso aos arquivos será realizado por meio de:

  - URLs temporárias (presigned URLs), ou
  - Endpoints autenticados do próprio backend

- O módulo de **certification** será o **único responsável** por:

  - Escrita
  - Leitura
  - Geração de URLs de acesso

Durante o desenvolvimento acadêmico e ambientes locais, será permitido utilizar:

- Object Storage local compatível com S3 (ex: MinIO)

Em ambientes produtivos, será utilizado:

- Serviço de Object Storage gerenciado, compatível com S3

Essa decisão garante que o armazenamento de arquivos já esteja **preparado arquiteturalmente** para a futura extração do módulo de certificados como serviço independente.

---

## Alternativas Consideradas

- Armazenamento de arquivos em disco local do servidor
- Armazenamento de arquivos no banco de dados relacional como BLOB

Essas alternativas foram descartadas por:

- Aumentarem o acoplamento entre aplicação e infraestrutura
- Dificultarem escalabilidade horizontal
- Tornarem mais complexa a extração futura do módulo de certificados
- Não serem adequadas para reutilização por outros sistemas

---

## Consequências

### Positivas

- Alta durabilidade e confiabilidade dos arquivos
- Escalabilidade independente da aplicação
- Separação clara entre dados transacionais e arquivos
- Facilita integração futura com outros sistemas
- Arquitetura alinhada com a futura extração como microsserviço
- Possibilidade de uso de MinIO em ambiente acadêmico

### Negativas

- Introduz dependência de infraestrutura adicional
- Leve aumento de complexidade na configuração inicial
- Exige cuidado com controle de acesso e expiração de URLs

---

## Diretrizes Arquiteturais

- Nenhum outro módulo além de **certification** pode acessar diretamente o storage
- O banco de dados relacional deve armazenar apenas:

  - Metadados do certificado
  - Referência lógica ao arquivo (ex: key, path)

- A estratégia de acesso aos arquivos deve respeitar:

  - Autenticação
  - Autorização
  - Expiração de acesso

---
