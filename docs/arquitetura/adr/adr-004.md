Perfeito. Segue a **ADR-004** revisada **em formato de Documento**, alinhada com tudo que já definimos (monólito modular, REST, OpenAPI, simplicidade, time iniciante, sem infra complexa), com linguagem normativa e consistente.

---

# ADR-004 — Autenticação: JWT com Refresh Token (Stateless)

**Status:** Aprovado

## Contexto

A aplicação será uma aplicação web com múltiplos perfis de usuário, desenvolvida em um contexto acadêmico por um time majoritariamente iniciante.

Na fase inicial do projeto, **não haverá**:

- Infraestrutura distribuída complexa
- Balanceadores de carga avançados
- Integração com provedores externos de identidade (SSO, OAuth de terceiros)

Mesmo com essas restrições, a aplicação precisa atender aos seguintes requisitos:

- Evitar uso de sessão em memória no servidor
- Permitir escalabilidade horizontal futura, se necessário
- Garantir um nível adequado de segurança para aplicações web
- Facilitar integrações futuras com aplicações mobile ou outros clientes
- Manter simplicidade de implementação e de entendimento

Dessa forma, a solução de autenticação precisa ser simples, amplamente conhecida e compatível com o ecossistema Spring.

## Decisão

Adotar um modelo de autenticação baseado em **JWT (JSON Web Token)** utilizando **Access Token** e **Refresh Token**, seguindo uma abordagem **stateless**.

A estratégia adotada seguirá os seguintes princípios:

- A autenticação será stateless, sem armazenamento de sessão em memória no backend
- O Access Token terá curta duração e será utilizado em todas as requisições autenticadas
- O Refresh Token será utilizado exclusivamente para renovação do Access Token
- O Refresh Token será armazenado de forma persistente no backend, associado ao usuário
- O backend não manterá estado de sessão entre requisições
- Todos os endpoints protegidos exigirão o envio do token no header HTTP:

  ```
  Authorization: Bearer <access_token>
  ```

O controle de expiração, renovação e invalidação de tokens será responsabilidade do backend.

## Alternativas Consideradas

- Autenticação baseada em sessão (HTTP Session)
- Cookies de sessão com armazenamento em memória
- OAuth 2.0 completo desde o início
- SSO com provedores externos

Essas alternativas foram descartadas por:

- Aumentarem a complexidade de infraestrutura
- Exigirem maior maturidade técnica do time
- Dificultarem o entendimento para desenvolvedores iniciantes
- Não serem necessárias para o escopo atual do projeto

## Consequências

### Consequências Positivas

- Arquitetura stateless e simples
- Facilidade de escalabilidade futura
- Compatibilidade com aplicações web e mobile
- Integração direta com o ecossistema Spring Security
- Redução de dependência de infraestrutura adicional
- Facilidade de testes e depuração

### Consequências Negativas

- Necessidade de cuidado no armazenamento e invalidação de Refresh Tokens
- Exposição do Access Token no cliente, exigindo boas práticas de segurança
- Maior responsabilidade do backend no controle de expiração e revogação

## Diretrizes de Implementação

- O Access Token deve conter apenas informações essenciais (id do usuário, papel, expiração)
- Tokens não devem conter dados sensíveis
- O Refresh Token deve ser armazenado de forma segura e persistente
- O endpoint de refresh deve validar:

  - Existência do Refresh Token
  - Associação correta ao usuário
  - Não expiração ou revogação

- Tokens comprometidos devem poder ser invalidados
- O uso de HTTPS é obrigatório em todos os ambientes

---
