# ADR-017 — Mensageria e Processamento Assíncrono (Filas de Jobs)

**Status:** Aprovado

## Contexto

O sistema já possui:

- Geração de certificados de forma assíncrona
- Relatórios potencialmente pesados
- Futuro compartilhamento de módulos com outros sistemas (Sistema de Eventos)
- Estratégia de futura extração para microsserviços

É necessário um mecanismo padrão para:

- Execução assíncrona
- Processamento desacoplado
- Escalabilidade futura

---

## Decisão

O sistema adotará um modelo de **mensageria baseado em filas de jobs**, com os seguintes princípios:

- Separação entre:
  - API (produtora de eventos)
  - Workers (consumidores)
- Processamento assíncrono não bloqueante
- Cada job possui:
  - Status (PENDING, PROCESSING, DONE, ERROR)
  - Tentativas
  - Retentativas automáticas
  - Log de falhas

Casos de uso imediatos:

- Geração de certificados
- Envio de e-mails
- Processamentos pesados de relatórios
- Integrações futuras entre sistemas

Além disso, o modelo adotado será compatível com:

- Execução em monólito modular no início
- Extração futura para microsserviços sem reescrita

---

## Alternativas Consideradas

- Processamento totalmente síncrono via API
- Execução por jobs agendados (cron)
- Execução manual de batch

---

## Consequências

- ✅ Evita bloqueio de requisições HTTP
- ✅ Melhor experiência para o usuário
- ✅ Isolamento de falhas
- ✅ Permite escalabilidade independente
- ✅ Arquitetura pronta para integração entre sistemas
- ✅ Alinhado com a extração futura de microsserviços
- ❌ Exige worker e controle de estado dos jobs
- ❌ Aumenta levemente a complexidade inicial

---
